scheming_version: 2
dataset_type: dataset
about: AuScope Instrument Registry schema based on PIDINST
about_url: https://www.github.com/AuScope/AuScope-instrument-registry

dataset_fields:
  - field_name: doi
    label: Identifier
    form_placeholder: Persistent identifier (DOI) of the instrument instance
    form_attrs:
      disabled: true
    help_text: Unique string that identifies the instrument instance
    groupBy: About Instrument

  - field_name: schema_version
    label: Schema Version
    form_snippet: hidden_field.html
    form_placeholder: Version number of the PIDINST schema used in this record
    help_text: Version number of the PIDINST schema used in this record
    groupBy: About Instrument

  # - field_name: identifierType
  #   label: IdentifierType
  #   form_placeholder: Type of the identifier
  #   form_attrs:
  #     disabled: true
  #   help_text: Unique string that identifies the instrument instance
  #   groupBy: About Instrument

  # - field_name: landing_page
  #   label: Landing Page URL
  #   form_placeholder: A landing page that the identifier resolves to
  #   help_text: A landing page that the identifier resolves to
  #   groupBy: About Instrument

  - field_name: title
    label: Title
    preset: title
    form_placeholder: Name by which the instrument instance is known
    help_text: "Name by which the instrument instance is known"
    groupBy: About Instrument

  - field_name: name
    label: URL
    preset: dataset_slug
    form_snippet: hidden_field.html
    form_placeholder: eg. my-instrument
    groupBy: About Instrument

  - field_name: version_number
    label: Version
    required: false
    form_snippet: hidden_field.html
    display_snippet: null
    validators: ignore_missing int_validator
    default: 1
    groupBy: About Instrument

  - field_name: version_handler_id
    label: Version Handler ID
    form_snippet: hidden_field.html
    display_snippet: null
    validators: ignore_missing
    required: false
    groupBy: About Instrument

  - field_name: owner_org
    label: Organization
    form_snippet: org_visibility.html
    groupBy: About Instrument

  - field_name: owner
    label: Owners
    preset: composite_repeating
    validators: composite_repeating_validator
    form_snippet: composite_repeating_field.html
    required: true
    groupBy: About Instrument
    composite_rules:
      - when_present: owner_identifier
        require: [owner_identifier_type]
    subfields:
      - field_name: owner_name
        label: Owner Name
        required: true
        display_property: dc:creator
        help_text: Full name of the owner

      - field_name: owner_contact
        label: Owner Contact
        required: true
        display_snippet: None
        display_email_name_field: owner_name
        validators: ignore_missing unicode_safe strip_value email_validator
        help_text: Contact address of the owner

      - field_name: owner_identifier
        label: Owner Identifier
        help_text: "Identifier used to identify the owner"

      - field_name: owner_identifier_type
        label: Owner Identifier Type
        help_text: "Type of the identifier"

      - field_name: owner_relationship_type
        label: Owner Relationship Type
        preset: select
        required: true
        choices:
          - value: HostingInstitution
            label: HostingInstitution
          - value: DataCollector
            label: DataCollector
          - value: Sponsor
            label: Sponsor
        help_text: The type of the date

  - field_name: instrument_type
    label: Instrument Type
    preset: composite_repeating
    validators: composite_repeating_validator
    form_snippet: composite_repeating_field.html
    form_blanks: 1
    groupBy: About Instrument
    subfields:
      - field_name: instrument_type_name
        label: Instrument Type Name
        required: true
        help_text: Classification of the type of the instrument

      - field_name: instrument_type_identifier
        label: Instrument Type Identifier
        help_text: Identifier for the instrument type

      - field_name: instrument_type_identifier_type
        label: Instrument Type Identifier Type
        # Do we need to keep choices or there always free texts?
        # preset: select
        # choices:
        #   - value: URL
        #     label: URL
        #   - value: Other
        #     label: Other
        help_text: "Type of the identifier"

  - field_name: manufacturer
    label: Manufacturer
    preset: composite_repeating
    validators: composite_repeating_validator
    form_snippet: composite_repeating_field.html
    required: true
    form_blanks: 1
    groupBy: About Instrument
    composite_rules:
      - when_present: manufacturer_identifier
        require: [manufacturer_identifier_type]
    subfields:
      - field_name: manufacturer_name
        label: Manufacturer Name
        required: true
        help_text: Full name of the manufacturer

      - field_name: manufacturer_identifier
        label: Manufacturer Identifier
        help_text: Identifier used to identify the manufacturer

      - field_name: manufacturer_identifier_type
        label: Manufacturer Identifier Type
        help_text: "Type of the identifier"

  - field_name: model
    label: Model
    required: true
    preset: composite_repeating
    validators: composite_repeating_validator
    form_snippet: composite_repeating_field.html
    form_blanks: 1
    groupBy: About Instrument
    composite_rules:
      - when_present: model_identifier
        require: [model_identifier_type]
    subfields:
      - field_name: model_name
        label: Model Name
        required: true
        help_text: Full name of the model

      - field_name: model_identifier
        label: Model Identifier
        help_text: Identifier used to identify the model

      - field_name: model_identifier_type
        label: Model Identifier Type
        help_text: "Type of the identifier"

  - field_name: date
    label: Date
    preset: composite_repeating
    validators: composite_repeating_validator
    form_snippet: composite_repeating_field.html
    form_blanks: 1
    groupBy: About Instrument
    subfields:
      - field_name: date_value
        label: Date
        preset: date
        required: true
        help_text: Dates relevant to the instrument

      - field_name: date_type
        label: Date Type
        preset: select
        required: true
        choices:
          - value: Commissioned
            label: Commissioned
          - value: DeCommissioned
            label: DeCommissioned
        help_text: The type of the date

  - field_name: measured_variable
    label: Measured Variable
    preset: tag_string_autocomplete
    help_text: The variable(s) that this instrument measures or observes
    groupBy: About Instrument

  - field_name: gcmd_keywords_code
    label: GCMD Science Keywords
    # required: true
    form_snippet: gcmd_field.html
    display_snippet: gcmd_field.html
    help_text: Global Change Master Directory (GCMD) science keywords
    groupBy: About Instrument

  - field_name: gcmd_keywords
    label: GCMD Science Keywords
    form_snippet: hidden_field.html
    help_text: Global Change Master Directory (GCMD) science keywords
    display_snippet: null
    groupBy: About Instrument

  - field_name: user_keywords
    label: User Specified Keywords
    preset: tag_string_autocomplete
    validators: tag_string_convert
    help_text: Keywords help with the discovery of the instrument
    groupBy: About Instrument

  - field_name: description
    label: Description
    preset: markdown
    help_text: Technical description of the device and its capabilities
    groupBy: About Instrument

  - field_name: funder
    label: Funding References
    preset: composite_repeating
    form_snippet: composite_repeating_field.html
    validators: composite_repeating_validator
    form_blanks: 0
    groupBy: About Instrument
    composite_rules:
      - when_present: funder_identifier
        require: [funder_name, funder_identifier_type]
    subfields:
      - field_name: funder_name
        label: Funder Name
        help_text: Name of the funding provider

      - field_name: funder_identifier
        label: Funder Identifier
        help_text: Uniquely identifies a funding entity, according to various types

      - field_name: funder_identifier_type
        label: Funder Identifier Type
        help_text: The type of the funderIdentifier
        # Conditionally Required
        default: ROR
        required: true
        preset: select
        choices:
          - value: ROR
            label: ROR
          - value: CrossrefFunderID
            label: Crossref Funder ID
          - value: GRID
            label: GRID
          - value: ISNI
            label: ISNI
          - value: Other
            label: Other

      - field_name: schema_uri
        label: Schema URI
        help_text: The URI of the funder identifier scheme. Specially,

      - field_name: award_number
        label: Award Number
        help_text: The code assigned by the funder to a sponsored award (grant).

      - field_name: award_uri
        label: Award URI
        help_text: The URI leading to a page provided by the funder for more information about the award (grant).

      - field_name: award_title
        label: Award Title
        help_text: The human readable title or name of the award (grant).

  - field_name: credit
    label: Credit
    form_snippet: textarea.html
    help_text: The Credit field is where you acknowledge people or organisations who contributed
    groupBy: About Instrument

  - field_name: alternate_identifier_obj
    label: Alternate Identifier
    preset: composite_repeating
    form_snippet: composite_repeating_field.html
    validators: composite_repeating_validator
    form_blanks: 1
    groupBy: About Instrument
    required: true
    composite_rules:
      - when_present: alternate_identifier
        require: [alternate_identifier_type]
      - when_equals:
          field: alternate_identifier_type
          value: Other
        require: [alternate_identifier_name]
    subfields:
      - field_name: alternate_identifier
        label: Alternate Identifier
        help_text: Identifiers other than the PIDINST pertaining to the same instrument instance. This should be used if the instrument has a serial number. Other possible uses include an owner's inventory number or an entry in some instrument data base.

      - field_name: alternate_identifier_name
        label: Alternate Identifier Name
        help_text: A supplementary name for the identifier type. This is mostly useful for "Other"

      - field_name: alternate_identifier_type
        label: Alternate Identifier Type
        # Conditionally Required
        required: true
        preset: select
        choices:
          - value: SerialNumber
            label: Serial Number
          - value: InventoryNumber
            label: Inventory Number
          - value: Other
            label: Other
        help_text: Type of the identifier

  # ======================== RELATED RESOURCES ========================
  - field_name: related_identifier_obj
    label: Related Identifier
    preset: composite_repeating
    form_snippet: composite_repeating_field.html
    validators: composite_repeating_validator
    scheming_validators: [ensure_single_isnewversionof]
    form_blanks: 0
    groupBy: Related Resources
    composite_rules:
      - when_present: related_identifier
        require: [related_identifier_type]
      - when_equals:
          field: related_resource_type
          value: Instrument
        require: [related_instrument_package_id]
    subfields:
      - field_name: related_identifier
        label: Related Identifier
        help_text: Identifiers of related resources

      - field_name: related_identifier_type
        label: Related Identifier Type
        required: true
        preset: select
        choices:
          - value: ARK
            label: ARK
          - value: arXiv
            label: arXiv
          - value: bibcode
            label: bibcode
          - value: DOI
            label: DOI
          - value: EAN13
            label: EAN13
          - value: EISSN
            label: EISSN
          - value: Handle
            label: Handle
          - value: IGSN
            label: IGSN
          - value: ISBN
            label: ISBN
          - value: ISSN
            label: ISSN
          - value: ISTC
            label: ISTC
          - value: LISSN
            label: LISSN
          - value: PMID
            label: PMID
          - value: PURL
            label: PURL
          - value: RAiD
            label: RAiD
          - value: RRID
            label: RRID
          - value: UPC
            label: UPC
          - value: URL
            label: URL
          - value: URN
            label: URN
          - value: w3id
            label: w3id
        help_text: Type of the identifier

      - field_name: related_identifier_name
        label: Related Identifier Name
        help_text: A name for the related resource (optional)

      - field_name: related_resource_type
        label: Resource Type
        required: true
        preset: select
        form_attrs:
          data-pidinst-reltype-driver: "1"
        choices:
          - value: Document
            label: Document
          - value: Instrument
            label: Instrument
          - value: Metadata
            label: Metadata
          - value: Dataset
            label: Dataset
          - value: Version
            label: Version
        help_text: Choose what kind of thing this identifier refers to. This will filter Relation Type options.

      - field_name: relation_type
        label: Relation Type
        required: true
        preset: select
        form_attrs:
          data-pidinst-reltype-target: "1"
        choices:
          - value: IsDescribedBy
            label: IsDescribedBy (The instrument is described by the document)
          - value: HasPart
            label: HasPart (The instrument has the related resource as a part)
          - value: IsPartOf
            label: IsPartOf (The instrument is part of the related resource)
          - value: HasMetadata
            label: HasMetadata (The instrument has related metadata for the resource)
          - value: IsMetadataFor
            label: IsMetadataFor (The resource has metadata describing the instrument)
          - value: Collects
            label: Collects (The instrument collects the related dataset)
          - value: IsNewVersionOf
            label: IsNewVersionOf (The instrument is a new version of the related resource)
        help_text: Description of the relationship

      - field_name: related_instrument_package_id
        label: Related Instrument Package ID
        form_snippet: composite_hidden_field.html
        display_snippet: null
        validators: ignore_missing
        help_text: Internal CKAN package ID of the selected instrument (used for prepopulation)

      - field_name: instrument_relation_role
        label: Instrument Relation Role
        form_snippet: composite_hidden_field.html
        display_snippet: null
        validators: ignore_missing
        help_text: Role of the related instrument (child or parent)

  # ================= GEOLOCATION FIELDS =================
  - field_name: locality
    label: Locality
    help_text: The locality or named place where the instrument is located
    groupBy: Spatial & Temporal

  - field_name: location_choice
    label: Location Details
    preset: radio
    choices:
      - value: noLocation
        label: "No"
      # - value: area
      #   label: Area on Map
      - value: point
        label: Single point on Map
    default: noLocation
    display_snippet: map_field.html
    help_text: Choose how to specify the location.
    validators: location_validator
    groupBy: Spatial & Temporal

  - field_name: map_display
    label: Map Display
    form_snippet: map_field_single_point.html
    display_snippet: null
    help_text: Interactive map for selecting coordinates.
    groupBy: Spatial & Temporal

  - field_name: location_data
    label: Location Data
    form_snippet: null
    display_snippet: null
    preset: json_object
    groupBy: Spatial & Temporal

  - field_name: spatial
    label: Spatial
    form_snippet: null
    display_snippet: null
    preset: json_object
    groupBy: Spatial & Temporal

  - field_name: epsg_code
    label: Geographic Coordinate System
    help_text: "A geographic coordinate system is a three-dimensional reference system that locates points on the Earth's surface. We use EPSG (https://epsg.io/) to represent the coordinate system"
    form_snippet: null
    display_snippet: null
    groupBy: Spatial & Temporal

  - field_name: epsg
    label: Geographic Coordinate System
    form_snippet: hidden_field.html
    help_text: "A geographic coordinate system is a three-dimensional reference system that locates points on the Earth's surface. We use EPSG (https://epsg.io/) to represent the coordinate system"
    display_snippet: null
    groupBy: Spatial & Temporal

  # XXX This will be auto-generated after DOI minting, see metadata document

  - field_name: publisher
    label: Publisher
    required: true
    preset: select
    choices:
      - value: AuScope
        label: AuScope
    default: AuScope
    form_include_blank_choice: false
    help_text: The entity that publishes the instrument
    form_snippet: hidden_field.html
    display_snippet: publisher_field.html
    groupBy: About Instrument

  - field_name: publisher_identifier
    label: Publisher Identifier
    required: true
    preset: select
    choices:
      - value: "https://ror.org/04s1m4564"
        label: https://ror.org/04s1m4564
    default: https://ror.org/04s1m4564
    form_include_blank_choice: false
    form_snippet: hidden_field.html
    display_snippet: null
    help_text: The persistent identifier of the publisher
    validators: ignore_missing unicode_safe strip_value url_validator
    groupBy: About Instrument

  - field_name: publisher_identifier_type
    label: Publisher Identifier Type
    required: true
    default: ROR
    preset: select
    choices:
      - value: ROR
        label: ROR
    form_include_blank_choice: false
    form_snippet: hidden_field.html
    display_snippet: null
    help_text: The type of the persistent identifier represents the publisher
    groupBy: About Instrument

  - field_name: publication_date
    label: Publication Date
    form_snippet: hidden_field.html
    preset: date
    help_text: The date the instrument is published through the repository
    groupBy: About Instrument


  - field_name: primary_contact_name
    label: Primary Contact Name
    required: true
    default: AuScope Instrument Repository
    help_text: A primary contact can be approached by users requesting further information of the instrument
    form_snippet: hidden_field.html
    groupBy: About Instrument

  - field_name: primary_contact_email
    label: Primary Contact Email
    required: true
    default: help@data.auscope.org.au
    display_snippet: email.html
    # display_email_name_field: primary_contact_name
    help_text: Email of the primary contact
    form_snippet: hidden_field.html
    groupBy: About Instrument

  - field_name: citation
    label: Citation
    form_snippet: null
    display_snippet: null
    help_text: The full bibliographic citation of the instrument
    groupBy: About Instrument


resource_fields:
  - field_name: url
    label: URL
    preset: resource_url_upload
    required: true
    validators: resource_url_validator

  - field_name: name
    label: Name
    help: The name of the resource (will be auto-generated from file name if not provided)

  - field_name: pidinst_is_cover_image
    label: Cover photo
    form_snippet: cover_photo_checkbox.html
    display_snippet: null
    default: "false"
    validators: ignore_missing boolean_validator
    output_validators: ignore_missing boolean_validator
    help_text: Set this to use the uploaded image as the instrument cover photo.

  - field_name: description
    label: Description
    preset: markdown
    form_placeholder: Some useful notes about the resource

  - field_name: format
    label: Format
    preset: resource_format_autocomplete


