{% ckan_extends %}

{% block facet_list %}
    {% set hide_empty = hide_empty or false %}
    {% with items = items or h.get_facet_items_dict(name, search_facets) %}
        {% if items or not hide_empty %}
            {% if name not in ['groups', 'license_id', 'res_format'] %}
                {% block facet_list_item %}
                    <section class="facet-section" data-module="facet-collapse-module">
                        {% block facet_list_heading %}
                            <h2 class="facet-section-heading" role="button" aria-expanded="true" aria-controls="facet-{{ name }}">
                                <span>{{ title }}</span>
                                <i class="fa fa-chevron-up facet-toggle-icon"></i>
                            </h2>
                        {% endblock %}

                        {% block facet_list_items %}
                            <div id="facet-{{ name }}" class="facet-section-body">
                                {% with items = items or h.get_facet_items_dict(name, search_facets) %}
                                    {# Search input for facets with many items #}
                                    {% if items|length > 6 %}
                                        <input type="text"
                                               class="facet-search-input"
                                               placeholder="{{ _('Search') }}"
                                               data-facet-filter="{{ name }}"
                                               autocomplete="off" />
                                    {% endif %}

                                    {% if items %}
                                        <ul class="facet-check-list">
                                            {% for item in items %}
                                                {% set label = label_function(item) if label_function else item.display_name %}
                                                {% set label_truncated = label|truncate(35) if not label_function else label %}
                                                {% set count = count_label(item['count']) if count_label else ('%d' % item['count']) %}
                                                <li class="facet-check-item" data-facet-value="{{ label_truncated|lower }}">
                                                    <label>
                                                        <input type="checkbox"
                                                               name="{{ name }}"
                                                               value="{{ item.name }}"
                                                               {% if item.active %}checked{% endif %}
                                                               data-facet-checkbox />
                                                        <span class="facet-label">{{ label_truncated }}</span>
                                                        <span class="facet-count">({{ count }})</span>
                                                    </label>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p class="facet-empty">
                                            {{ _('There are no {facet_type} that match this search').format(facet_type=title) }}
                                        </p>
                                    {% endif %}
                                {% endwith %}
                            </div>
                        {% endblock %}
                    </section>
                {% endblock %}
            {% endif %}
        {% endif %}
    {% endwith %}
{% endblock %}
